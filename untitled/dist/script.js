const promptTemplates=["Ultra detailed dystopian sci-fi megacity at night, endless neon billboards with AI propaganda, drones patrolling sky, heavy rain, cinematic lighting, volumetric fog, hyper-detailed","Lonely hacker on rooftop of decayed cyberpunk city, holographic ads flickering, glitch effects, neon blue and magenta, dramatic backlight, 8k ultra realistic","Massive surveillance tower controlled by AI system, thousands of glowing sensors scanning crowd below, cold desaturated palette, dystopian mood, wide cinematic shot","Futuristic control room with dozens of holographic interfaces, AI core in center as glowing sphere, dark environment, cyan and purple accents, ultra detailed UI","Abandoned AI research facility in middle of desert, broken robots and cables everywhere, sunset light, dust in air, cinematic, post-apocalyptic sci-fi","Gigantic mech walking through ruined futuristic city, sparks and smoke, orange and teal palette, dramatic perspective, detailed armor","Portrait of cybernetic character controlled by AI, glowing eyes, facial implants, barcode on neck, dark background, rim light, hyper realistic","Floating AI-controlled prison in sky, supported by energy beams, storm clouds around, lightning, dramatic wide-angle shot, dark dystopian style","Sci-fi underground data center, endless rows of servers with neon lights, foggy air, central corridor leading into darkness, cinematic perspective","Alien city under AI control, organic architecture fused with holographic tech, strange symbols in air, bioluminescent fog, high detail"];let historyVault=JSON.parse(localStorage.getItem('poz_vault'))||[];function switchTab(id){document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.querySelector(`.tab-btn[onclick="switchTab('${id}')"]`).classList.add('active');document.getElementById('tab-'+id).classList.add('active');if(id==='vault')renderVault('full-vault')}function getSizeByRatio(ratio){switch(ratio){case "9:16":return{width:768,height:1365};case "16:9":return{width:1365,height:768};default:return{width:1024,height:1024}}}async function generateImage(){const prompt=document.getElementById('prompt-input').value.trim();const model=document.getElementById('model-select').value;const quality=document.getElementById('quality-select').value;const ratio=document.getElementById('ratio-select').value;const container=document.getElementById('image-container');const statusLine=document.getElementById('status-line');const btn=document.getElementById('btn-gen');if(!prompt){alert("Сначала опиши сцену");return}const{width,height}=getSizeByRatio(ratio);container.innerHTML='<div style="padding:20px;color:#38bdf8">>>> PROCESSING NEURAL DATA...</div>';statusLine.textContent=`Модель: ${model} | Формат: ${ratio} (${width}x${height})`;btn.disabled=true;try{const imageElement=await puter.ai.txt2img(prompt,{model,quality,width,height});imageElement.classList.add("generated-img");container.innerHTML='';container.appendChild(imageElement);saveToVault(imageElement.src||imageElement.currentSrc||"",prompt);statusLine.textContent+="  // Рендер завершён"}catch(err){console.error(err);container.innerHTML='<div style="padding:20px;color:#f97316">>> ERROR: РЕНДЕР НЕ УДАЛСЯ. ПОПРОБУЙ ДРУГУЮ МОДЕЛЬ</div>';statusLine.textContent="Ошибка генерации. Попробуй другой промпт/модель"}finally{btn.disabled=false}}function saveToVault(url,prompt){historyVault.unshift({url,prompt});if(historyVault.length>64)historyVault.pop();localStorage.setItem('poz_vault',JSON.stringify(historyVault));renderVault('mini-vault',4)}function renderVault(elementId,limit=100){const grid=document.getElementById(elementId);if(!grid)return;const items=historyVault.slice(0,limit).map(item=>`<div class="vault-item" onclick="showFromVault('${encodeURIComponent(item.url)}')"><img src="${item.url}" loading="lazy"></div>`).join('');grid.innerHTML=items||'<div style="padding:20px;color:#9ca3af;text-align:center">Пока нет кадров</div>'}function showFromVault(encodedUrl){const url=decodeURIComponent(encodedUrl);const container=document.getElementById('image-container');container.innerHTML='';const img=new Image();img.src=url;img.className="generated-img";container.appendChild(img)}function clearVault(){localStorage.removeItem('poz_vault');historyVault=[];renderVault('full-vault');renderVault('mini-vault')}document.getElementById('promptGeneratorBtn').addEventListener('click',()=>{const base=promptTemplates[Math.floor(Math.random()*promptTemplates.length)];const current=document.getElementById('prompt-input').value.trim();const ratio=document.getElementById('ratio-select').value;let ratioText="";if(ratio==="9:16")ratioText=", vertical composition, perfect for mobile wallpapers and shorts";if(ratio==="16:9")ratioText=", wide cinematic composition, perfect for YouTube thumbnails";const finalPrompt=base+ratioText;document.getElementById('prompt-input').value=current?current+", "+finalPrompt:finalPrompt});renderVault('mini-vault',4);